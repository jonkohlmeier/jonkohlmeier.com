---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import SiteLayout from '../layouts/SiteLayout.astro';
import HeroSection from '../components/HeroSection.astro';
import SectionHeader from '../components/SectionHeader.astro';
import ContentGrid from '../components/ContentGrid.astro';
import PostPreviewCard from '../components/PostPreviewCard.astro';
import AdvisoryCard from '../components/AdvisoryCard.astro';
import QuoteBlock from '../components/QuoteBlock.astro';
import CTASection from '../components/CTASection.astro';
import Avatar from '../assets/profile-pic.jpg';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const advisory = (await getCollection('advisory')).sort(
  (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0),
);
---

<SiteLayout
  title="Puffs of Smoke"
  description="Pipes, product, and leadership musings from technologist Jonathan Kohlmeier."
>
  <HeroSection
    eyebrow="Home base"
    title="Building trustworthy products, RevOps systems, and the teams that power them."
    description="I’m Jonathan Kohlmeier—an engineering-minded RevOps leader blending technology, hospitality, and a fondness for pipe smoke. Puffs of Smoke is where essays, frameworks, and advisory work help people-first operators win without losing their craft."
    primaryCta={{ label: 'Read the latest essays', href: '/writing/' }}
    secondaryCta={{ label: 'Explore advisory services', href: '/services/', variant: 'secondary' }}
  >
    <Image
      slot="aside"
      src={Avatar}
      width={320}
      height={320}
      alt="Portrait of Jonathan Kohlmeier"
      class="hero-portrait mx-auto h-auto w-full max-w-xs"
    />
  </HeroSection>

  <section class="bg-[var(--color-surface-muted)] py-4">
    <div class="container-page flex flex-wrap items-center justify-between gap-3 text-sm text-subtle">
      <p>Writing and advisory for operators who care about craftsmanship.</p>
      <div class="flex flex-wrap gap-2 text-xs uppercase tracking-[0.3em] text-muted">
        <span>RevOps</span>
        <span>Product Ops</span>
        <span>Leadership</span>
        <span>Pipes</span>
      </div>
    </div>
  </section>

  <section class="section-gap">
    <div class="container-page space-y-8">
      <SectionHeader
        eyebrow="Fresh writing"
        title="Latest essays and field notes"
        description="Ideas tested in RevOps war rooms, over AeroPress brews, and occasionally beside a briar pipe."
      />
      <ContentGrid>
        {posts.map((post) => (
          <PostPreviewCard post={post} />
        ))}
      </ContentGrid>
    </div>
  </section>

  <section class="section-gap bg-[var(--color-surface)]">
    <div class="container-page space-y-8">
      <SectionHeader
        eyebrow="Advisory"
        title="Fractional leadership for thoughtful teams"
        description="Choose the partnership that keeps momentum without sacrificing craft."
      />
      <ContentGrid columns={2}>
        {advisory.map((item) => (
          <AdvisoryCard
            name={item.data.name}
            description={item.data.description}
            who={item.data.who_it_is_for}
            outcomes={item.data.outcomes}
            ctaLabel={item.data.cta_label}
            ctaLink={item.data.cta_link}
          />
        ))}
      </ContentGrid>
    </div>
  </section>

  <QuoteBlock
    quote="Most of this started as notes over a pipe. It turned into a way to help people-first teams win without burning out their craft."
    author="Jonathan Kohlmeier"
    role="Technologist & RevOps partner"
  />

  <CTASection
    title="Need a trusted partner for your next RevOps or product initiative?"
    description="Let’s map your systems, build go-to-market clarity, and give your team the instrumentation they need to move faster." 
    ctaLabel="Start a conversation"
    ctaLink="/contact/"
  />
</SiteLayout>
