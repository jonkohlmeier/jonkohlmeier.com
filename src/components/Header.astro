---
import ThemeToggle from './ThemeToggle.astro';
import { NAV_LINKS } from '../data/navigation';
import { SOCIAL_LINKS } from '../data/social';

const pathname = Astro.url.pathname.endsWith('/') ? Astro.url.pathname : `${Astro.url.pathname}/`;

const isActive = (href: string, aliases: string[] = []) => {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href) || aliases.some((alias) => pathname.startsWith(alias));
};
---

<header class="border-b border-[var(--color-border)]" style="background-color: var(--color-bg); backdrop-filter: blur(12px);">
  <div class="container-page flex items-center justify-between gap-4 py-4">
    <a href="/" class="flex flex-col text-left">
      <span class="text-xs uppercase tracking-[0.4em] text-subtle">Puffs of Smoke</span>
      <span class="text-lg font-semibold text-[var(--color-text)]">Jonathan Kohlmeier</span>
    </a>
    <div class="flex items-center gap-3 lg:hidden">
      <ThemeToggle />
      <button
        class="btn-ghost border border-[var(--color-border)] px-3 py-2 text-subtle"
        type="button"
        aria-label="Toggle navigation"
        aria-expanded="false"
        data-mobile-toggle
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
          <path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" />
        </svg>
      </button>
    </div>
    <nav class="hidden w-full items-center justify-center gap-3 lg:flex">
      {NAV_LINKS.map((link) => (
        <a
          class={`btn-ghost px-4 py-2 text-sm font-medium transition ${
            isActive(link.href, link.aliases) ? 'bg-[var(--color-surface-muted)] text-[var(--color-accent)]' : 'text-subtle'
          }`}
          href={link.href}
        >
          {link.label}
        </a>
      ))}
    </nav>
    <div class="hidden items-center gap-3 lg:flex">
      {SOCIAL_LINKS.map((link) => (
        <a
          class="btn-ghost text-xs uppercase tracking-[0.3em] text-subtle hover:text-[var(--color-accent)]"
          href={link.url}
          target={link.url.startsWith('/') ? undefined : '_blank'}
          rel={link.url.startsWith('/') ? undefined : 'noopener noreferrer'}
        >
          {link.label}
        </a>
      ))}
      <ThemeToggle />
    </div>
  </div>
  <div class="mobile-nav hidden border-t border-[var(--color-border)] bg-[var(--color-surface)] lg:hidden" data-mobile-menu>
    <div class="container-page flex flex-col gap-4 py-6">
      <nav class="flex flex-col gap-2">
        {NAV_LINKS.map((link) => (
          <a
            class={`rounded-full px-4 py-2 text-base font-medium transition ${
              isActive(link.href, link.aliases)
                ? 'bg-[var(--color-surface-muted)] text-[var(--color-accent)]'
                : 'text-subtle hover:bg-[var(--color-surface-muted)]'
            }`}
            href={link.href}
          >
            {link.label}
          </a>
        ))}
      </nav>
      <div class="flex flex-wrap gap-3 text-xs uppercase tracking-[0.3em] text-subtle">
        {SOCIAL_LINKS.map((link) => (
          <a
            class="rounded-full border border-[var(--color-border)] px-3 py-1 hover:border-[var(--color-accent)] hover:text-[var(--color-accent)]"
            href={link.url}
            target={link.url.startsWith('/') ? undefined : '_blank'}
            rel={link.url.startsWith('/') ? undefined : 'noopener noreferrer'}
          >
            {link.label}
          </a>
        ))}
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const toggle = document.querySelector('[data-mobile-toggle]');
  const menu = document.querySelector('[data-mobile-menu]');
  if (toggle && menu) {
    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', (!expanded).toString());
      menu.classList.toggle('hidden');
    });
  }
</script>
